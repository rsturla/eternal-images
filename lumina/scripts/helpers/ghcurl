#!/usr/bin/env bash
set -euo pipefail

# Check for GITHUB_TOKEN in build secret mount (Containerfile mounts at /buildcontext/secrets/GITHUB_TOKEN)
if [[ -f /buildcontext/secrets/GITHUB_TOKEN ]]; then
  GITHUB_TOKEN=$(< /buildcontext/secrets/GITHUB_TOKEN)
  echo "Using GITHUB_TOKEN from build secret for authentication." >&2
  AUTH_HEADER="Authorization: Bearer $GITHUB_TOKEN"
else
  echo "GITHUB_TOKEN secret not found. Using unauthenticated requests." >&2
  AUTH_HEADER=""
fi

URL="$1"
shift
OPTIONS=("$@")

if [[ -n "$AUTH_HEADER" ]]; then
  curl -sSL -H "$AUTH_HEADER" "${OPTIONS[@]}" "$URL"
else
  curl -sSL "${OPTIONS[@]}" "$URL"
fi
